<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Knockout.viewmodel : " />
    <script src="web/javascripts/prism.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="web/stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="screen" href="web/stylesheets/prism.css">

    <title>Knockout Viewmodel - Cleaner, Faster, Better Knockout Mapping</title>
</head>

<body class="language-javascript">

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
            <a id="forkme_banner" href="https://github.com/coderenaissance/knockout.viewmodel">View on GitHub</a>

            <h1 id="project_title">Knockout Viewmodel Plugin  </h1>
            <h2 id="project_tagline">Cleaner, Faster, Better Knockout Mapping</h2>

            <section id="downloads">
                <a class="zip_download_link" href="https://github.com/coderenaissance/knockout.viewmodel/zipball/master">Download this project as a .zip file</a>
                <a class="tar_download_link" href="https://github.com/coderenaissance/knockout.viewmodel/tarball/master">Download this project as a tar.gz file</a>
                <div style="text-align: right; font-weight: bold; font-size: larger">
                    Download Latest Version<br />
                    <a style="font-size: .8em" href="http://nuget.org/packages/knockout.viewmodel/">(also on Nuget)</a>
                </div>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
        <section id="main_content" class="inner">
            <h2>The Knockout Viewmodel Plugin (ko.viewmodel)</h2>
            <section id="intro" class="inner">
                <h3>The fastest mapping plugin!</h3>
                <p>
                    The knockout viewmodel plugin runs <a href="http://jsperf.com/ko-viewmodel-vs-ko-mapping-complex-viewmodel-creation">several times faster</a> than the knockout mapping plugin. It also allows you to fine tune your viewmodel creation for even more speed. 
                    Now you can create complex observable viewmodels easily and with more structure and control than ever before!
                </p>
            </section>
            <section id="trust" class="inner">
                <h3>You can trust that it works!!!</h3>
                <p>
                    There is a growing <a href="Tests/Tests.htm">suite of unit-tests</a> that ensures that ko.viewmodel works reliably. Bug fixes always start with one or more new unit test so reliability goes up over time.
                </p>
            </section>
            <section id="viewmodel" class="inner">
                <h3>Converting models to viewmodels</h3>
                <p>Your model is most commonly json data from the server. Your viewmodel is a copy of the model that has been modified with any observables, computeds, and functions needed by the view (html with bindings). 
				<br/><br/>A lot of knockout tutorials start by showing a manually built veiwmodel with values wrapped in observables. In the real world though you will usually start with a json model from your server that needs to be converted to a viewmodel. In order to update the server with changes this mapping will need to be reversed. The viewmodel plugin lets you do this in a maintainable, flexable way.</p>
            </section>
            <section id="create" class="inner">
                <h3>Creating a simple viewmodel</h3>
                <p>This code creates a view model with an observable array of users whose properties are observable.</p>
                <pre><code>
model = {//your model is normally provided via an ajax call
  users:[ 
        {firstName:"John", lastName:"Doe"},
        {firstName:"James", lastName:"Smith"}
    ]
};

viewmodel = ko.viewmodel.fromModel(model);
			</code></pre>
			<p>This example relies on the default mapping provided by the fromModel method. These rules can be overridden by passing in mapping options as a second parameter (<a href="#MappingBuilder">discussed later</a>).</p>
			<h5>Default Mapping</h5>
			<ul>
			<li>Objects in the model are mapped to objects in the viewmodel.</li>
			<li>All non-object json properties in the model are mapped to observables containing those values.</li>
			<li>Arrays are mapped to observablesArrays unless they are direct children of arrays, e.g. this json [ [], [] ] maps to an observable array containing two non-observable arrays. </li>
			</ul>
            </section>
			<section id="toModel" class="inner">
                <h3>Getting an updated model</h3>

                <p>At somepoint you'll need to get an updated model to send back up to the server. This can be done by calling toModel and passing in your viewmodel.</p>

                <pre><code>
model = ko.viewmodel.toModel(viewmodel);
        </code></pre>
			<p>The toModel method follows default unmapping rules unless mapping options were specified in the original fromModel call </p>	
			<h5>Default Unmapping</h5>
					<ul>
					<li>Objects in the viewmodel are mapped to objects in a new model</li>
					<li>All observable properties, including observable arrays, are unwrapped and added to the model</li>
					<li>All non-observable, non-object json data will be appended to the viewmodel.</li>
					<li>Functions, computed values, and non-json data	 are ignored.</li>
					</ul>
			</section>
            <section id="updateFromModel" class="inner">
                <h3>Updating a viewmodel</h3>

                <p>If you need to update your viewmodel with more recent model data this can be done by calling updateFromModel.</p>

                <pre><code>
ko.viewmodel.updateFromModel(viewmodel, updatedModel);
                </code></pre>

                <p>This method optionally takes a third parameter, makeNoncontiguousObjectUpdates. When set to true it can help eliminate long running script errors in older browsers by creating an update function for each object and calling it via setTimeout. Given the overhead of creating all of these functions makeNoncontiguousObjectUpdates should only be set to true if you are getting long running script errors in older browsers. An onComplete method allows you to pass in a callback to be fired when noncontiguous object updates are completed.</p>
                <pre><code>
ko.viewmodel.updateFromModel(viewmodel, updatedModel, true).onComplete(function(){
    //respond to completion of update
});
                </code></pre>
                <p>Note: the onComplete method is only available when makeNoncontiguousObjectUpdates is set to true.</p>
            </section>
            <section id="MappingBuilder">
                <h3>Mapping Builder - Building more complicated viewmodels</h3>
                <p>
                    The basic mapping we've seen so far does a one to one mapping from properties on a model to observable properties on a viewmodel and back. This is useful but limiting. 
                    To take more control of mapping you need to use the mapping builder, which provides a chaining syntax to allow you
                    to define complex mappings from viewmodels to models and back. 
                </p>
            </section>
			<section id="paths" class="inner">
                <h3>Mapping Paths</h3>

                <p>Mappings can be specified for any item by it's path. Every full path starts with {root}. Items in an array are referred to as [i]. So a path of "{root}.users[i].firstName" would be used to specify custom processing for the firstName property of every object in the users array. That is its full path name, but it's not necessary to refer to every item by it's -full path name. There are three ways of referencing a path:</p>

                <ul>
                    <li>Full Path Name - Matches only the specific path, e.g. "{root}.users[i].firstName".</li>
                    <li>Parent Child-Name - Matches the parent child combination specified. So "users[i].firstName" will only match the first name property on objects in the users array. Array items have to be referenced as ParentName[i].ChildName but for all other objects the proper reference is ParentName.ChildName</li>
                    <li>Property Name - Matches every property with that name. So a partial path of "firstName" would match every firstName property in your model.</li>
                </ul>
            </section>
            <section id="simpleExample" class="inner">
                <h3>A simple mapping example - Extending your viewmodel</h3>
                <p>
                    Lets say that you want to extend each object in the users array with an isDeleted flag. You define this mapping using the mapping builders extend function:
                </p>
                <pre><code>
var mapping = ko.viewmodel.mappingBuilder();
mapping.extend("{root}.users[i]",
    function extendUser(user){
        user.isDeleted = ko.observable(false);
    }
);

viewmodel = ko.viewmodel.fromModel(model, mapping));

//note: it was important to provide a name for the function above (i.e. extendUser) 
//because that name will showup in callstacks and profiling
</code></pre>
			</section>
			<section id="paths" class="inner">
                <h3>Mapping Methods</h3>

                <p>Each of the following processing methods can be called on a path</p>

                <ul>
                    <li><a href="web/mappingBuilder/append.html">Append</a> - Indicates that model value should be added to the viewmodel unchanged.</li>
					<li><a href="web/mappingBuilder/exclude.html">Exclude</a> - Indicates that the specified path should be ignored and not added to the viewmodel.</li>
					<li><a href="web/mappingBuilder/flagasnullable.html">FlagAsNullable</a> - Flags objects as nullable. Nullable objects cannot be properly processed without this flag.</li>
					<li><a href="web/mappingBuilder/transform.html">Transform</a> - Allows the model value to be formatted/transformed before mapping and then transformed back after unmapping.</li>
					<li><a href="web/mappingBuilder/extend.html">Extend</a> - Allows an path to be extended after it's been through mapping processing.</li>
					<li><a href="web/mappingBuilder/custom.html">Custom</a> - Allows complete control over processing of a path.</li>
					<li><a href="web/mappingBuilder/arraychildid.html">ArrayChildId</a> - Specifies what property of objects in an array should be used to identify objects when they are updated.</li>
                </ul>
            </section>

            </section>

            <section id="globalOptions" class="inner">
                <h3>Global Options</h3>
                <p>
                    Global options affect all calls to ko.viewmodel and are access and set via ko.viewmodel.options. Currently there are two global options:
                </p>

                <ul>
                    <li>logging - (default:false) logs viewmodel processing to the console, including all paths processed and mapping options applied.</li>
                    <li>makeChildArraysObservable - (default:true) determines if nested arrays are converted to observable arrays. 
                        Set to false for compatibility with original mapping plugin or to improve performance.
                    </li>
                </ul>
            </section>
            <section id="arrayMethods" class="inner">
                <h3>Observable Array Mapping Methods</h3>
                Once an observable array has been mapped, items which need to be added and removed can be processed through viewmodel mapping using the following
                methods which are added to the observable array.
                
                <ul>
                    <li>pushFromModel - modifies the object passed in according to the original mapping options, and calls array.push</li>
                    <li>unshiftFromModel - modifies the object passed in according to the original mapping options and calls array.unshift</li>
                    <li>popToModel - calls array.pop and unmaps and returns the object according to the original mapping options</li>
                    <li>shiftToModel - calls array.shift and unmaps and returns the object according to the original mapping options</li>
                </ul>
            </section>

            <section id="bug" class="inner">
                <h3>Think you've found a bug?</h3>
                If you think you've found a bug please submit a <a href="https://github.com/coderenaissance/knockout.viewmodel/issues?state=open">new issue ticket </a>. 
            All bug fixes start with failing unit tests so <a href="http://jsfiddle.net/CodeRenaissance/nx2yx/">including one</a> will help speed things along... thanks!
            </section>

        </section>


    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
        <footer class="inner">
            <p class="copyright">Knockout.viewmodel maintained by <a href="https://github.com/coderenaissance">coderenaissance</a></p>
            <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
        </footer>
    </div>



</body>
</html>
