//v2.0.0 - C 2013, Dave Herren, License: MIT 
ko.viewmodel=function(){function m(a){return null===a||void 0===a}function v(a){return null===a||void 0===a||a.constructor===String||a.constructor===Number||a.constructor===Boolean||a instanceof Date}function n(a,f,d){var b,c,e,g,h;h=f?f[d.full]||f[d.parent]||f[d.name]||{}:{};l&&l(d,h,f);l&&l(d);if(b=h.custom)"function"===typeof b?c=b(a):(c=b.map(a),m(c)||(c.___$mapCustom=b.map,b.unmap&&(c.___$unmapCustom=b.unmap)));else if(h.append)m(a)||(a.___$appended=void 0),c=a;else{if(h.exclude)return q;if(v(a))c=
d.parentIsArray?a:x(a);else if(a instanceof Array){c=[];e=0;for(b=a.length;e<b;e++)c[e]=n(a[e],f,{name:"[i]",parent:d.name+"[i]",full:d.full+"[i]",parentIsArray:!0});if(!0!==w||!d.parentIsArray){g={name:"[i]",parent:d.name+"[i]",full:d.full+"[i]",parentIsArray:!0};c=y(c);if(a=h.arrayChildId)c.___$childIdName=a;c.pushFromModel=function(a){a=n(a,f,g);c.push(a)};c.unshiftFromModel=function(a){a=n(a,f,g);c.unshift(a)};c.popToModel=function(a){a=c.pop();return p(a,g)};c.shiftToModel=function(a){a=c.shift();
return p(a,g)}}}else if(a.constructor===Object)for(e in c={},a)b=n(a[e],f,{name:e,parent:("[i]"===d.name?d.parent:d.name)+"."+e,full:d.full+"."+e}),b!==q&&(c[e]=b)}if(h=h.extend)"function"===typeof h?c=h(c)||c:h.constructor===Object&&("function"===typeof h.map&&(c=h.map(c)||c),"function"===typeof h.unmap&&(c.___$unmapExtend=h.unmap));return c}function p(a,f){var d,b,c,e=r(a),g;g=a!==e;l&&l(f);if(!g&&a&&a.constructor===Function)return q;if(a&&a.___$unmapCustom)d=a.___$unmapCustom(a);else if(g&&v(e)||
m(e)||e.hasOwnProperty("___$appended"))d=e;else if(e instanceof Array){d=[];b=0;for(c=e.length;b<c;b++)d[b]=p(e[b],{name:"[i]",parent:f.name+"[i]",full:f.full+"[i]"})}else if(e.constructor===Object)for(b in d={},e){if("___$"!==b.substr(0,2)&&(g=e[b],!ko.isComputed(g)&&!((c=r(g))&&c.constructor===Function)))g=p(g,{name:b,parent:("[i]"===f.name?f.parent:f.name)+"."+b,full:f.full+"."+b}),g!==q&&(d[b]=g)}else!g&&"function"!==typeof e&&(d=e);a&&a.___$unmapExtend&&(d=a.___$unmapExtend(d,a));return d}function s(a,
f,d){var b,c,e,g,h,k,j=r(f);c=f!==j;l&&l(d);if(c&&m(j)^m(a))f(a);else if(a&&j&&j.constructor==Object&&a.constructor===Object)for(b in a)c=j[b],!m(c)&&f.hasOwnProperty("___$appended")?j[b]=a:c&&"function"===typeof c.___$mapCustom?z(c)?(e=c.___$mapCustom(a[b]),e=r(e),c(e)):j[b]=j[b].___$mapCustom(a[b]):m(a[b])&&j[b]&&j[b].constructor===Object?j[b]=a[b]:s(a[b],j[b],{name:b,parent:("[i]"===d.name?d.parentChildName:d.name)+"."+b,full:d.full+"."+b});else if(j&&j instanceof Array)if(k=f.___$childIdName){g=
[];for(b=a.length-1;0<=b;b--){e=!1;h=a[b][k];for(c=j.length-1;0<=c;c--)if(h===j[c][k]()){s(a[b],j[c],{name:"[i]",parentChildName:d.name+"[i]",full:d.full+"[i]"});e=!0;g[c]=!0;break}e||f.splice(b,1)}for(b=a.length-1;0<=b;b--)g[b]||f.pushFromModel(a[b])}else if(c=[],j=f.___$mapCustom,"function"===typeof j){b=0;for(d=a.length;b<d;b++)c[b]=a[b];f(j(c))}else{f(c);b=0;for(d=a?a.length:0;b<d;b++)f.pushFromModel(a[b])}else c&&f(a)}function t(a,f){w=a.mappingCompatability;window.console&&a.logging?(console.log(f),
l=function(a,b,c){console.log("- "+(b&&b.settingType?b.settingType+" "+a.full+" (matched: '"+((c[a.full]?a.full:"")||(c[a.parent]?a.parent:"")||a.name)+"')":"default "+a.full))}):l=void 0}var r=ko.utils.unwrapObservable,z=ko.isObservable,x=ko.observable,y=ko.observableArray,u={name:"{root}",parent:"{root}",full:"{root}"},l,w,q=function(){};return{options:{mappingCompatability:!1,logging:!1},fromModel:function(a,f){var d={},b=f?f.shared||{}:{},c,e,g,h,k;for(k in f)if(c=f[k]||{},"shared"!==k)if(c instanceof
Array){e=0;for(h=c.length;e<h;e++)g=c[e],d[g]={},d[g][k]=!0,d[g].settingType=k}else for(g in c)d[g]={},e=c[g],e="arrayChildId"!==k&&e&&e.constructor===String&&b[e]?b[e]:e,d[g][k]=e,d[g].settingType=k;t(this.options,"Mapping From Model");return n(a,d,u)},toModel:function(a){t(this.options,"Mapping To Model");return p(a,u)},updateFromModel:function(a,f){t(this.options,"Update From Model");return s(f,a,u)}}}();