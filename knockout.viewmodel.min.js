//version 1.1.0 Copyright 2013 Dave Herren
ko.viewmodel=function(){function n(a,d){var e;ko.viewmodel.logging&&window.console&&(e=d&&d.settingType?d.settingType+" "+a.qualifiedName+" (matched: '"+((d[a.qualifiedName+":"+d.settingType]?a.qualifiedName:"")||(d[a.parentChildName+":"+d.settingType]?a.parentChildName:"")||a.name)+"')":"default "+a.qualifiedName,window.console.log("- "+e))}function p(a,d){return null===a||"string"===d||"number"===d||"boolean"===d||"object"===d&&"function"===typeof a.getMonth}function l(a,d){return null!=a&&"object"===
d&&void 0===a.length&&!p(a,d)}function q(a,d){return null!=a&&"object"===d&&void 0!==a.length}function m(a,d,e){var c,b,f,g;c=typeof a;var k,j=d?d[e.qualifiedName]||d[e.parentChildName]||d[e.name]||{}:{};n(e,j);if(j.custom)"function"===typeof j.custom?b=j.custom(a):(b=j.custom.map(a),null===b||void 0===b||(b["..map"]=j.custom.map,j.custom.unmap&&(b["..unmap"]=j.custom.unmap)));else if(j.append)null!=a&&(a["..appended"]=void 0),b=a;else{if(j.exclude)return;if(p(a,c))b=e.parentIsArray?a:v(a),j.id&&
(b["..isid"]=!0);else if(l(a,c)){b={};g=void 0;for(f in a)c=m(a[f],d,{name:f,parentChildName:("[i]"===e.name?e.parentChildName:e.name)+"."+f,qualifiedName:e.qualifiedName+"."+f}),void 0!==c&&(b[f]=c,g=b[f]&&b[f]["..isid"]?f:g);g&&(b["..idName"]=g)}else if(q(a,c)){b=[];for(f=0;f<a.length;f++)b[f]=m(a[f],d,{name:"[i]",parentChildName:e.name+"[i]",qualifiedName:e.qualifiedName+"[i]",parentIsArray:!0});if(!0!==ko.viewmodel.mappingCompatability||!e.parentIsArray)k={name:"[i]",parentChildName:e.name+"[i]",
qualifiedName:e.qualifiedName+"[i]",parentIsArray:!0},b=w(b),b["..push"]=b.push,b["..unshift"]=b.unshift,b["..shift"]=b.shift,b["..pop"]=b.pop,b.push=function(a,c){void 0!==a&&(a=!c||c.map?m(a,d,k):a,b["..push"](a))},b.unshift=function(a,c){void 0!==a&&(a=!c||c.map?m(a,d,k):a,b["..unshift"](a))}}}return j.extend?j.extend(b)||b:b}function r(a,d){var e,c,b=s(a),f=a===b,g=typeof b;n(d,null);if(null===a)return null;if(void 0!==a&&a["..unmap"])e=a["..unmap"](a);else if(null===b||b.hasOwnProperty("..appended"))e=
b;else if(p(b,g)&&!f)e=b;else if(l(b,g))for(c in e={},b)e[c]=r(b[c],{name:c,parentChildName:("[i]"===d.name?d.parentChildName:d.name)+"."+c,qualifiedName:d.qualifiedName+"."+c});else if(q(b,g)){e=[];for(c=0;c<b.length;c++)e.push(r(b[c],{name:"[i]",parentChildName:d.name+"[i]",qualifiedName:d.qualifiedName+"[i]"}))}return e}function t(a,d,e){var c,b,f,g,k,j,h=s(d);b=typeof h;f=d!==h;n(e,null);if(!(null===d||void 0===d)&&!d.hasOwnProperty("..appended"))if(!(void 0===d||h===a))if(f&&(null===h||void 0===
h)^(null===a||void 0===a))d(a);else if(l(h,b)&&l(a,b))for(c in a)(d=h[c])&&"function"===typeof d["..map"]?x(d)?d(s(d["..map"](a[c]))):h[c]=h[c]["..map"](a[c]):a&&null===a[c]&&l(h[c],typeof h[c])?h[c]=null:t(a[c],h[c],{name:c,parentChildName:("[i]"===e.name?e.parentChildName:e.name)+"."+c,qualifiedName:e.qualifiedName+"."+c});else if(q(h,b))if(j=h[0]["..idName"]){g=[];for(c=a.length-1;0<=c;c--){f=!1;k=a[c][j];for(b=h.length-1;0<=b;b--)if(k===h[b][j]()){t(a[c],h[b],{name:"[i]",parentChildName:e.name+
"[i]",qualifiedName:e.qualifiedName+"[i]"});f=!0;g[b]=!0;break}f||d.splice(c,1)}for(c=a.length-1;0<=c;c--)g[c]||d.push(a[c])}else{d([]);for(c=0;c<a.length;c++)"function"===typeof d["..map"]?d.push(d["..map"](a)):d.push(a[c])}else f&&d(a)}var s=ko.utils.unwrapObservable,x=ko.isObservable,v=ko.observable,w=ko.observableArray,u={name:"{root}",parentChildName:"{root}",qualifiedName:"{root}"};return{mappingCompatability:!1,logging:!1,fromModel:function(a,d){var e={},c,b,f,g;for(g in d)if(c=d[g]||{},void 0!==
c.length)for(b=0;b<c.length;b++)f=c[b],e[f]={},e[f][g]=!0,e[f].settingType=g;else for(f in c)e[f]={},e[f][g]=c[f],e[f].settingType=g;ko.viewmodel.logging&&window.console&&window.console.log("Mapping From Model");return m(a,e,u)},toModel:function(a){ko.viewmodel.logging&&window.console&&window.console.log("Mapping To Model");return r(a,u)},updateFromModel:function(a,d){ko.viewmodel.logging&&window.console&&window.console.log("Update From Model");return t(d,a,u)}}}();