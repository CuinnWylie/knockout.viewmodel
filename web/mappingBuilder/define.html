<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Knockout.viewmodel : " />
    <script src="../javascripts/prism.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/prism.css">

    <title>Knockout Viewmodel - Cleaner, Faster, Better Knockout Mapping</title>
</head>

<body class="language-javascript">

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
            <a id="forkme_banner" href="https://github.com/coderenaissance/knockout.viewmodel">View on GitHub</a>

            <h1 id="project_title">Knockout Viewmodel Plugin  </h1>
            <h2 id="project_tagline">Cleaner, Faster, Better Knockout Mapping</h2>

            <section id="downloads">
                <a class="zip_download_link" href="https://github.com/coderenaissance/knockout.viewmodel/zipball/master">Download this project as a .zip file</a>
                <a class="tar_download_link" href="https://github.com/coderenaissance/knockout.viewmodel/tarball/master">Download this project as a tar.gz file</a>
                <div style="text-align: right; font-weight: bold; font-size: larger">
                    Download Latest Version<br />
                    <a style="font-size: .8em" href="http://nuget.org/packages/knockout.viewmodel/">(also on Nuget)</a>
                </div>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
        <section id="main_content" class="inner">
            <h2>mappingBuilder - define</h2>
            <section id="intro" class="inner">
			<h3>define(name, fn)</h3>
                <p>
                    Defines a shared function that can be specified in place of function definitions when calling the custom and extend methods.
                </p>
				<h5>Custom Observable Object Example - wrap objects in observable and don't wrap its properties</h5>
                <pre><code>
var mappingOptions = ko.viewmodel.mappingBuilder()
	.define("customObservableObject", function(item){
		return ko.observableArray(item);	
	})
	.extend("{root}.OpenOrders", "nullableArrayMap", "nullableArrayUnmap")
	.extend("{root}.ProcessedOrders", "nullableArrayMap", "nullableArrayUnmap");
	
var viewmodel = ko.viewmodel.fromModel(model, mappingOptions);
                </code></pre>	
				<br/>
				<h5>Extend Trim String Example - no processing on mapping, trimming values on unmapping</h5>
                <pre><code>
var mappingOptions = ko.viewmodel.mappingBuilder()
	.define("trimString", function(item){
		var val = ko.utils.unwrapObservable(item);//works if observable (for extend) or not (custom).
		if(typeOf val === "string"){
			val = val.trim();//Assumes modern browser that includes trim method or polyfill
			if(ko.isObservable(item){//if item was observable (extend) store value
				item(val);
			}
			else{//if not observable (custom or unmapping) then assign trimmed value to item
				item = val;
			}
		}
		return item;//return item whether altered or not
	})
	.define("passthru", function(item){//no processing on mapping
		return item;
	}
	.extend("{root}.User.FirstName", "passthru", "trimString")
	.extend("{root}.User.LastName", "passthru", "trimString")
	.extend("{root}.User.MiddleInitial", "passthru", "trimString")
	.extend("{root}.User.Email", "passthru", "trimString");
	
var viewmodel = ko.viewmodel.fromModel(model, mappingOptions);
                </code></pre>
<br/>				
				<h5>Nullable Object Example with Extend - Ensure objects are observable so nulls can be updated</h5>
                <pre><code>
var mappingOptions = ko.viewmodel.mappingBuilder()
	.define("nullableObjectMap", function(item){
		//nulls are observable by default but objects aren't
		//this wraps objects in observables
		return ko.isObservable(item) ? item : ko.observable(item);
	})
	.extend("{root}.CustomPlan", "nullableObjectMap")
	.extend("{root}.Address", "nullableObjectMap");
	
var viewmodel = ko.viewmodel.fromModel(model, mappingOptions);
                </code></pre>
				<br/>
				<h5>Nullable Array Example with Extend - convert nulls to empty arrays on mapping and back on unmapping</h5>
                <pre><code>
var mappingOptions = ko.viewmodel.mappingBuilder()
	.define("nullableArrayMap", function(item){
		//convert nulls to emptyObservableArrays
		return item.peek() === null ? ko.observableArray([]) : item;	
	})
	.define("nullableArrayUnmap", function(item){
		//convert empty arrays back to nulls
		return item.length === 0 ? null : item;	
	})
	.extend("{root}.OpenOrders", "nullableArrayMap", "nullableArrayUnmap")
	.extend("{root}.ProcessedOrders", "nullableArrayMap", "nullableArrayUnmap");
	
var viewmodel = ko.viewmodel.fromModel(model, mappingOptions);
                </code></pre>				
            </section>
        </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
        <footer class="inner">
            <p class="copyright">Knockout.viewmodel maintained by <a href="https://github.com/coderenaissance">coderenaissance</a></p>
            <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
        </footer>
    </div>

</body>
</html>
